using UnityEngine;
using UnityEngine.InputSystem;

public class PlayerController : MonoBehaviour
{
    public CharacterController controller;
    public GameObject bulletPrefab;
    public Transform firePoint;

    public float speed = 6f;
    public float gravity = -9.8f;
    public int maxAmmo = 12;

    int ammo;
    Vector3 velocity;
    PlayerInput input;
    InputAction moveAction, shootAction, reloadAction;

    public bool canClimb = false;

    void Awake()
    {
        input = GetComponent<PlayerInput>();
        moveAction = input.actions["Move"];
        shootAction = input.actions["Shoot"];
        reloadAction = input.actions["Reload"];
    }

    void Start()
    {
        ammo = maxAmmo;
        GameController.Instance.UpdateBullets(ammo);
    }

    void Update()
    {
        if (!GameController.Instance.gameStarted) return;

        Move();
        if (shootAction.triggered) Shoot();
        if (reloadAction.triggered) Reload();
    }

    void Move()
    {
        Vector2 inputMove = moveAction.ReadValue<Vector2>();
        Vector3 move = transform.right * inputMove.x + transform.forward * inputMove.y;
        controller.Move(move * speed * Time.deltaTime);

        velocity.y += gravity * Time.deltaTime;
        controller.Move(velocity * Time.deltaTime);
    }

    void Shoot()
    {
        if (ammo == 0) return;
        Instantiate(bulletPrefab, firePoint.position, firePoint.rotation);
        ammo--;
        GameController.Instance.UpdateBullets(ammo);
    }

    void Reload()
    {
        ammo = maxAmmo;
        GameController.Instance.UpdateBullets(ammo);
    }
}