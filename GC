using UnityEngine;
using TMPro;

public class GameController : MonoBehaviour
{
    public static GameController Instance;

    public bool gameStarted = false;
    public int totalTargets = 0;
    public int hitsToDestroy = 2;

    public TMP_Text playerNameText;
    public TMP_Text bulletText;
    public TMP_Text timerText;

    public PlayerController player;
    public Transform goal;

    float timer = 0f;

    void Awake()
    {
        Instance = this;
        Time.timeScale = 0f; // pause until game starts
    }

    void Update()
    {
        if (!gameStarted) return;

        timer += Time.deltaTime;
        timerText.text = "Time: " + Mathf.FloorToInt(timer).ToString();
    }

    public void StartGame(string playerName)
    {
        playerNameText.text = "Player: " + playerName;
        gameStarted = true;
        Time.timeScale = 1f;
    }

    public void TargetDestroyed()
    {
        totalTargets--;
        if (totalTargets <= 0)
        {
            Debug.Log("All targets destroyed! You can now go to the goal.");
            player.canClimb = true;
        }
    }

    public void UpdateBullets(int bullets)
    {
        bulletText.text = "Bullets: " + bullets;
    }

    public void StopGame()
    {
        gameStarted = false;
        Time.timeScale = 0f;
        Debug.Log("Goal reached! Final Time: " + Mathf.FloorToInt(timer));
    }
}